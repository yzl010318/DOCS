import{Logger as k,removeEndingSlash as h,entries as m,removeLeadingSlash as g,isLinkHttp as P,isLinkAbsolute as b,deepAssign as R,fromEntries as p,isPlainObject as w,isArray as L,keys as z,isFunction as S,getFullLocaleConfig as D,getModulePath as E,addViteSsrNoExternal as C}from"@vuepress/helper";import{fs as s,path as f,colors as _,getDirname as F}from"vuepress/utils";import{createPage as j}from"vuepress/core";const A=async a=>{a.pages.every(({path:e})=>e!=="/")&&a.pages.push(await j(a,{path:"/",frontmatter:{title:"Home"},content:`Redirecting to the correct locale...
`}))},v="@vuepress/plugin-redirect",d=new k(v),M=({config:a,defaultBehavior:e,defaultLocale:c,localeFallback:n},t,i)=>`<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="robots" content="noindex">
  <title>Redirecting...</title>
  <script>
    const { hash, origin, pathname } = window.location;
    const routePath = pathname.substring(${i.length});
    const { languages } = window.navigator;
    const anchor = hash.substring(1);

    const config = ${JSON.stringify(a)};
    const availableLocales = ${JSON.stringify(t)};
    const defaultLocale = ${t.includes(c)?JSON.stringify(c):"availableLocales.pop()"};
    const defaultBehavior = ${JSON.stringify(e)}

    let matchedLocalePath = null;

    // get matched locale
    findLanguage:
      for (const lang of languages)
        for (const [localePath, langs] of Object.entries(config))
          if (langs.includes(lang)) {
${n?`            if (!availableLocales.includes(localePath))
              continue;
`:""}            matchedLocalePath = localePath;
            break findLanguage;
          }

    // default link
    const defaultLink = defaultLocale? \`\${origin}${h(i)}\${defaultLocale}\${routePath}\${anchor? \`#\${anchor}\`: ""}\`: null;

    // a locale matches
    if (matchedLocalePath) {
      const localeLink = \`\${origin}${h(i)}\${matchedLocalePath}\${routePath}\${anchor? \`#\${anchor}\`: ""}\`;

      if (availableLocales.includes(matchedLocalePath)) {
        location.href = localeLink;
      }
      // the page does not exist
      else {
        // locale homepage
        if (defaultBehavior === "homepage") {
          location.href = \`\${origin}${h(i)}\${matchedLocalePath}\`;
        }
        // default locale page
        else if (defaultBehavior === "defaultLocale" && defaultLink) {
          location.href = defaultLink;
        }
        // as is to get a 404 page of that locale
        else {
          location.href = localeLink;
        }
      }
    }
    // we have a default page
    else if (defaultLink) {
      location.href = defaultLink;
    }
    else {
      location.href = \`\${origin}${h(i)}/404.html\`;
    }
  <\/script>
</head>
<body>
  <p>Redirecting...</p>
</body>
</html>
`,T=async({dir:a,options:e,pages:c},n)=>{const t=c.filter(({pathLocale:l})=>l==="/").map(({path:l})=>l),i={};c.filter(({pathLocale:l})=>l!=="/").forEach(({path:l,pathLocale:o})=>{const r=l.replace(o,"/").replace(/\/$/,"/index.html");t.includes(r)||(i[r]??=[]).push(o)});const{succeed:$}=d.load("Generating locale redirect files");await Promise.all(m(i).map(async([l,o])=>{const r=a.dest(g(l));s.existsSync(r)||(await s.ensureDir(f.dirname(r)),await s.writeFile(r,M(n,o,e.base)))})),$()},B=a=>`<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="robots" content="noindex">
  <meta http-equiv="refresh" content="0; url=${a}">
  <link rel="canonical" href="${a}">
  <title>Redirecting...</title>
  <script>
    const anchor = window.location.hash.substring(1);
    window.location.replace(\`${a}\${anchor? \`#\${anchor}\`: ""}\`);
  <\/script>
</head>
<body>
  <p>Redirecting...</p>
</body>
</html>
`,I=async({dir:a,options:e},c,n="")=>{const t=n?h(P(n)?n:`https://${n}`):"",{succeed:i}=d.load("Generating redirect files");await Promise.all(m(c).map(async([$,l])=>{const o=a.dest(g($));if(!s.existsSync(o)){const r=b(l)?`${t}${e.base}${g(l)}`:l;await s.ensureDir(f.dirname(o)),await s.writeFile(o,B(r))}})),i()},N=["defaultLocale","homepage","404"],O=(a,e)=>{const{locales:c}=a.siteData,n=R(p(m(c).filter(([t,{lang:i}])=>i?!0:(d.error(`Missing ${_.magenta("lang")} option for locale "${t}", this locale will be ignored!`),!1)).map(([t,{lang:i}])=>[t,[i]])),w(e.localeConfig)?p(m(e.localeConfig).map(([t,i])=>[t,L(i)?i:[i]])):{});return{config:n,autoLocale:e.autoLocale??!1,defaultLocale:e.defaultLocale||z(n).pop(),localeFallback:e.localeFallback??!0,defaultBehavior:e.defaultBehavior&&N.includes(e.defaultBehavior)?e.defaultBehavior:"defaultLocale"}},x=/#.*$/u,u=(a,e=!1)=>(e?a.replace(x,""):a).replace(/\/(?:README\.md)?$/i,"/index.html").replace(/(?:\.(?:md|html))?$/,".html"),H=(a,e)=>{const c=S(e.config)?e.config(a):w(e.config)?e.config:{};return{...p(a.pages.map(({frontmatter:n,path:t})=>L(n.redirectFrom)?n.redirectFrom.map(i=>[u(i,!0),t]):n.redirectFrom?[[u(n.redirectFrom,!0),t]]:[]).flat()),...p(m(c).map(([n,t])=>[u(n,!0),u(t)]))}},U=({frontmatter:a},e)=>{const{base:c}=e.siteData,{redirectTo:n}=a;if(n){const t=u(b(n)?`${c}${g(n)}`:n);(a.head??=[]).unshift(["script",{},`{const anchor = window.location.hash.substring(1);window.location.replace(\`${t}\${anchor? \`#\${anchor}\`: ""}\`);}`])}},V=[[["en","en-US"],{name:"English",hint:"Your primary language is $1, do you want to switch to it?",switch:"Switch to $1",cancel:"Cancel",remember:"Remember my choice"}],[["zh","zh-CN","zh-Hans"],{name:"简体中文",hint:"您的首选语言是 $1，是否切换到该语言？",switch:"切换到 $1",cancel:"取消",remember:"记住我的选择"}],[["zh-TW","zh-Hant"],{name:"繁體中文",hint:"您的首選語言是 $1，是否切換到該語言？",switch:"切換到 $1",cancel:"取消",remember:"記住我的選擇"}],[["de","de-DE"],{name:"Deutsch",hint:"Ihre bevorzugte Sprache ist $1, möchten Sie zu dieser wechseln?",switch:"Zu $1 wechseln",cancel:"Abbrechen",remember:"Meine Wahl merken"}],[["de-AT"],{name:"Deutsch (Österreich)",hint:"Ihre bevorzugte Sprache ist $1, möchten Sie zu dieser wechseln?",switch:"Zu $1 wechseln",cancel:"Abbrechen",remember:"Meine Wahl merken"}],[["vi","vi-VN"],{name:"Tiếng Việt",hint:"Ngôn ngữ chính của bạn là $1, bạn có muốn chuyển sang nó?",switch:"Chuyển sang $1",cancel:"Hủy",remember:"Nhớ lựa chọn của tôi"}],[["uk"],{name:"Українська",hint:"Вашою основною мовою є $1, чи бажаєте ви переключитися на неї?",switch:"Переключитися на $1",cancel:"Скасувати",remember:"Запам’ятати мій вибір"}],[["ru","ru-RU"],{name:"Русский",hint:"Ваш основной язык - $1, вы хотите переключиться на него?",switch:"Переключиться на $1",cancel:"Отмена",remember:"Запомнить мой выбор"}],[["br"],{name:"Português (Brasil)",hint:"A língua principal é $1, deseja mudar para ela?",switch:"Mudar para $1",cancel:"Cancelar",remember:"Lembrar minha escolha"}],[["pl","pl-PL"],{name:"Polski",hint:"Twoim głównym językiem jest $1, czy chcesz przełączyć się na niego?",switch:"Przełącz na $1",cancel:"Anuluj",remember:"Zapamiętaj moje wybory"}],[["sk","sk-SK"],{name:"Slovenčina",hint:"Vašou hlavnou jazykom je $1, chcete prepnúť naň?",switch:"Prepnúť na $1",cancel:"Zrušiť",remember:"Zapamätať si moju voľbu"}],[["fr","fr-FR"],{name:"Français",hint:"Votre langue principale est $1, voulez-vous la changer ?",switch:"Changer pour $1",cancel:"Annuler",remember:"Se souvenir de mon choix"}],[["tr","tr-TR"],{name:"Türkçe",hint:"Ana diliniz $1, ona geçmek ister misiniz?",switch:"$1'e geç",cancel:"İptal",remember:"Seçimimi hatırla"}],[["fi","fi-FI"],{name:"Suomi",hint:"Pääkielenäsi on $1, haluatko vaihtaa siihen?",switch:"Vaihda $1:een",cancel:"Peruuta",remember:"Muista valintani"}],[["hu","hu-HU"],{name:"Magyar",hint:"A fő nyelvét $1, szeretné váltani?",switch:"Váltás $1",cancel:"Mégse",remember:"Emlékezzen a választásomra"}],[["id","id-ID"],{name:"Bahasa Indonesia",hint:"Bahasa utama Anda adalah $1, apakah Anda ingin beralih ke sana?",switch:"Beralih ke $1",cancel:"Batal",remember:"Ingat pilihan saya"}],[["nl","nl-NL"],{name:"Nederlands",hint:"Uw primaire taal is $1, wilt u overschakelen?",switch:"Overschakelen naar $1",cancel:"Annuleren",remember:"Onthoud mijn keuze"}],[["ja","ja-JP"],{name:"日本語",hint:"あなたの主要な言語は $1 です。それに切り替えますか？",switch:"$1 に切り替える",cancel:"キャンセル",remember:"選択を記憶する"}],[["ko","ko-KO"],{name:"한국어",hint:"당신의 기본 언어는 $1입니다. 그것으로 전환 하시겠습니까?",switch:"$1로 전환",cancel:"취소",remember:"내 선택 기억하기"}],[["es","es-ES"],{name:"Español",hint:"Su idioma principal es $1, ¿desea cambiarlo?",switch:"Cambiar a $1",cancel:"Cancelar",remember:"Recordar mi elección"}],[["/pt"],{name:"Português",hint:"Sua língua principal é $1, deseja mudar para ela?",switch:"Mudar para $1",cancel:"Cancelar",remember:"Lembrar minha escolha"}]],{url:J}=import.meta,y=F(J),G=(a={})=>e=>{e.env.isDebug&&d.info("Options:",a);const c=O(e,a);let n=null;return{name:v,alias:{"@vuepress/plugin-redirect/modal":a.switchLocale==="modal"?f.resolve(y,"../client/components/RedirectModal.js"):E("@vuepress/helper/noopComponent",import.meta)},define:{__REDIRECT_CONFIG__:c,__REDIRECT_DIRECT__:a.switchLocale==="direct",__REDIRECT_MODAL__:a.switchLocale==="modal",__REDIRECT_LOCALES__:D({app:e,name:"redirect",config:a.locales,default:V})},extendsBundlerOptions:t=>{C(t,e,"@vuepress/helper")},extendsPage:t=>{U(t,e)},onInitialized:async()=>{n=H(e,a),e.env.isDebug&&d.info("Redirect Map:",n),a.autoLocale&&e.env.isDebug&&await A(e)},onPrepared:async()=>{await e.writeTemp("redirect/map.js",`export const redirectMap = ${e.env.isDev?JSON.stringify(n,null,2):"{}"};
`),e.env.isDev&&(n=null)},onGenerated:async()=>{await I(e,n),a.autoLocale&&await T(e,c)},clientConfigFile:f.join(y,"../client/config.js")}};export{G as redirectPlugin};
//# sourceMappingURL=index.js.map
