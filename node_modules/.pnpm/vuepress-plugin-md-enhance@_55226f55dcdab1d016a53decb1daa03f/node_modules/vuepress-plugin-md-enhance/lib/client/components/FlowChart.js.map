{"version":3,"file":"FlowChart.js","sources":["../../../src/client/components/FlowChart.ts"],"sourcesContent":["import { LoadingIcon, decodeData } from \"@vuepress/helper/client\";\nimport { useDebounceFn, useEventListener } from \"@vueuse/core\";\nimport type { Chart } from \"flowchart.ts\";\nimport type { PropType, VNode } from \"vue\";\nimport {\n  computed,\n  defineComponent,\n  h,\n  onMounted,\n  onUnmounted,\n  ref,\n  shallowRef,\n} from \"vue\";\n\nimport { flowchartPresets } from \"../utils/index.js\";\n\nimport \"../styles/flowchart.scss\";\n\nexport default defineComponent({\n  name: \"FlowChart\",\n\n  props: {\n    /**\n     * Flowchart code content\n     *\n     * 流程图代码内容\n     */\n    code: { type: String, required: true },\n\n    /**\n     * Flowchart id\n     *\n     * 流程图 id\n     */\n    id: { type: String, required: true },\n\n    /**\n     * Flowchart preset\n     *\n     * 流程图预设\n     */\n    preset: {\n      type: String as PropType<\"ant\" | \"pie\" | \"vue\">,\n      default: \"vue\",\n    },\n  },\n\n  setup(props) {\n    let flowchart: Chart | null = null;\n    const element = shallowRef<HTMLDivElement>();\n\n    const loading = ref(true);\n    const scale = ref(1);\n\n    const preset = computed<Record<string, unknown>>(\n      () => flowchartPresets[props.preset],\n    );\n\n    const getScale = (width: number): number =>\n      width < 419 ? 0.8 : width > 1280 ? 1 : 0.9;\n\n    useEventListener(\n      \"resize\",\n      useDebounceFn(() => {\n        if (flowchart) {\n          const newScale = getScale(window.innerWidth);\n\n          if (scale.value !== newScale) {\n            scale.value = newScale;\n\n            flowchart.draw(props.id, { ...preset.value, scale: newScale });\n          }\n        }\n      }, 100),\n    );\n\n    onMounted(async () => {\n      const { parse } = await import(\n        /* webpackChunkName: \"flowchart\" */ \"flowchart.ts\"\n      );\n\n      flowchart = parse(decodeData(props.code));\n\n      // Update scale\n      scale.value = getScale(window.innerWidth);\n\n      loading.value = false;\n\n      // Draw svg to #id\n      flowchart.draw(props.id, { ...preset.value, scale: scale.value });\n    });\n\n    onUnmounted(() => {\n      flowchart?.clean();\n      flowchart = null;\n    });\n\n    return (): (VNode | null)[] => [\n      loading.value\n        ? h(LoadingIcon, { class: \"flowchart-loading\", height: 192 })\n        : null,\n      h(\"div\", {\n        ref: element,\n        class: [\"flowchart-wrapper\", props.preset],\n        id: props.id,\n        style: {\n          display: loading.value ? \"none\" : \"block\",\n        },\n      }),\n    ];\n  },\n});\n"],"names":["FlowChart","defineComponent","props","flowchart","element","shallowRef","loading","ref","scale","preset","computed","flowchartPresets","getScale","width","useEventListener","useDebounceFn","newScale","onMounted","parse","decodeData","onUnmounted","h","LoadingIcon"],"mappings":"uUAkBA,IAAAA,EAAeC,EAAgB,CAC7B,KAAM,YAEN,MAAO,CAML,KAAM,CAAE,KAAM,OAAQ,SAAU,EAAK,EAOrC,GAAI,CAAE,KAAM,OAAQ,SAAU,EAAK,EAOnC,OAAQ,CACN,KAAM,OACN,QAAS,KACX,CACF,EAEA,MAAMC,EAAO,CACX,IAAIC,EAA0B,KAC9B,MAAMC,EAAUC,EAEVC,EAAAA,EAAUC,EAAI,EAAI,EAClBC,EAAQD,EAAI,CAAC,EAEbE,EAASC,EACb,IAAMC,EAAiBT,EAAM,MAAM,CACrC,EAEMU,EAAYC,GAChBA,EAAQ,IAAM,GAAMA,EAAQ,KAAO,EAAI,GAEzC,OAAAC,EACE,SACAC,EAAc,IAAM,CAClB,GAAIZ,EAAW,CACb,MAAMa,EAAWJ,EAAS,OAAO,UAAU,EAEvCJ,EAAM,QAAUQ,IAClBR,EAAM,MAAQQ,EAEdb,EAAU,KAAKD,EAAM,GAAI,CAAE,GAAGO,EAAO,MAAO,MAAOO,CAAS,CAAC,EAEjE,CACF,EAAG,GAAG,CACR,EAEAC,EAAU,SAAY,CACpB,KAAM,CAAE,MAAAC,CAAM,EAAI,KACoB,QAAA,cACtC,EAEAf,EAAYe,EAAMC,EAAWjB,EAAM,IAAI,CAAC,EAGxCM,EAAM,MAAQI,EAAS,OAAO,UAAU,EAExCN,EAAQ,MAAQ,GAGhBH,EAAU,KAAKD,EAAM,GAAI,CAAE,GAAGO,EAAO,MAAO,MAAOD,EAAM,KAAM,CAAC,CAClE,CAAC,EAEDY,EAAY,IAAM,CAChBjB,GAAW,MAAM,EACjBA,EAAY,IACd,CAAC,EAEM,IAAwB,CAC7BG,EAAQ,MACJe,EAAEC,EAAa,CAAE,MAAO,oBAAqB,OAAQ,GAAI,CAAC,EAC1D,KACJD,EAAE,MAAO,CACP,IAAKjB,EACL,MAAO,CAAC,oBAAqBF,EAAM,MAAM,EACzC,GAAIA,EAAM,GACV,MAAO,CACL,QAASI,EAAQ,MAAQ,OAAS,OACpC,CACF,CAAC,CACH,CACF,CACF,CAAC"}