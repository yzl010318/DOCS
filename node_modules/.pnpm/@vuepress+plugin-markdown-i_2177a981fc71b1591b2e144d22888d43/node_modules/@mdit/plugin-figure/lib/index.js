const u=(i,l)=>{i.attrs=i.attrs?.filter(([o])=>o!==l)??null},d=i=>{const l=i.attrs?.find(([o])=>o==="title")?.[1];return l?(u(i,"title"),l):i.content},k=(i,l={})=>{const o=n=>{for(let t=1,{length:r}=n.tokens;t<r-1;t++){const e=n.tokens[t];if(e.type!=="inline"||!e.children||e.children.length!==1&&e.children.length!==3||e.children.length===1&&e.children[0].type!=="image")continue;if(e.children.length===3){const[a,g,f]=e.children;if(a.type!=="link_open"||g.type!=="image"||f.type!=="link_close")continue}if(t!==0&&n.tokens[t-1].type!=="paragraph_open"||t!==r-1&&n.tokens[t+1].type!=="paragraph_close")continue;const c=n.tokens[t-1];c.type="figure_open",c.tag="figure",n.tokens[t+1].type="figure_close",n.tokens[t+1].tag="figure";const s=e.children.length===1?e.children[0]:e.children[1],h=d(s),[p]=i.parseInline(h,n.env);e.children.push(new n.Token("figcaption_open","figcaption",1)),e.children.push(...p.children??[]),e.children.push(new n.Token("figcaption_close","figcaption",-1)),l.focusable!==!1&&s.attrPush(["tabindex","0"])}};i.core.ruler.before("linkify","figure",o)};export{k as figure};
//# sourceMappingURL=index.js.map
