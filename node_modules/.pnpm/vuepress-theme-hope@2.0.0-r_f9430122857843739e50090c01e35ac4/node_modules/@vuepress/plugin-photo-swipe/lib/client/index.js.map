{"version":3,"file":"index.js","sources":["../../src/client/utils/createPhotoSwipe.ts"],"sourcesContent":["import { useEventListener } from '@vueuse/core'\nimport type PhotoSwipe from 'photoswipe'\nimport type { SlideData } from 'photoswipe'\nimport type { PhotoSwipeOptions } from '../helpers/index.js'\nimport type { PhotoSwipeBehaviorOptions } from '../typings.js'\nimport { resolveImageInfoFromLink } from './images.js'\nimport { LOADING_ICON } from './loadingIcon.js'\nimport { setupPhotoSwipe } from './setupPhotoSwipe.js'\n\nexport interface PhotoSwipeState {\n  open: (index: number) => void\n  close: () => void\n  destroy: () => void\n}\n\nconst getDataSource = (\n  imageLinks: string[],\n  photoswipe: PhotoSwipe | null = null,\n): SlideData[] => {\n  const dataSource = imageLinks.map<SlideData>((link) => ({\n    html: LOADING_ICON,\n    msrc: link,\n  }))\n\n  imageLinks.forEach((link, index) => {\n    void resolveImageInfoFromLink(link).then((data) => {\n      dataSource.splice(index, 1, data)\n      photoswipe?.refreshSlideContent(index)\n    })\n  })\n\n  return dataSource\n}\n\nexport const createPhotoSwipe = async (\n  images: string[],\n  {\n    scrollToClose = true,\n    download = true,\n    fullscreen = true,\n    ...photoSwipeOptions\n  }: PhotoSwipeBehaviorOptions & PhotoSwipeOptions,\n): Promise<PhotoSwipeState> => {\n  const { default: PhotoSwipe } = await import(\n    /* webpackChunkName: \"photo-swipe\" */ 'photoswipe'\n  )\n  let currentPhotoSwipe: PhotoSwipe | null = null\n\n  return {\n    open: (index: number): void => {\n      currentPhotoSwipe = new PhotoSwipe({\n        preloaderDelay: 0,\n        showHideAnimationType: 'zoom',\n        ...photoSwipeOptions,\n        index,\n        ...(scrollToClose\n          ? { closeOnVerticalDrag: true, wheelToZoom: false }\n          : {}),\n      })\n\n      setupPhotoSwipe(currentPhotoSwipe, { download, fullscreen })\n\n      currentPhotoSwipe.options.dataSource = getDataSource(\n        images,\n        currentPhotoSwipe,\n      )\n\n      // photoSwipe.addFilter('placeholderSrc', () => images[index])\n      currentPhotoSwipe.init()\n    },\n\n    close: (): void => {\n      currentPhotoSwipe?.close()\n    },\n\n    destroy: useEventListener('wheel', () => {\n      currentPhotoSwipe?.close()\n    }),\n  }\n}\n"],"names":["getDataSource","imageLinks","photoswipe","dataSource","link","LOADING_ICON","index","resolveImageInfoFromLink","data","createPhotoSwipe","images","scrollToClose","download","fullscreen","photoSwipeOptions","PhotoSwipe","currentPhotoSwipe","setupPhotoSwipe","useEventListener"],"mappings":"+TAeA,MAAMA,EAAgB,CACpBC,EACAC,EAAgC,OAChB,CAChB,MAAMC,EAAaF,EAAW,IAAgBG,IAAU,CACtD,KAAMC,EACN,KAAMD,CACR,EAAE,EAEF,OAAAH,EAAW,QAAQ,CAACG,EAAME,IAAU,CAC7BC,EAAyBH,CAAI,EAAE,KAAMI,GAAS,CACjDL,EAAW,OAAOG,EAAO,EAAGE,CAAI,EAChCN,GAAY,oBAAoBI,CAAK,CACvC,CAAC,CACH,CAAC,EAEMH,CACT,EAEaM,EAAmB,MAC9BC,EACA,CACE,cAAAC,EAAgB,GAChB,SAAAC,EAAW,GACX,WAAAC,EAAa,GACb,GAAGC,CACL,IAC6B,CAC7B,KAAM,CAAE,QAASC,CAAW,EAAI,KACQ,QAAA,YACxC,EACA,IAAIC,EAAuC,KAE3C,MAAO,CACL,KAAOV,GAAwB,CAC7BU,EAAoB,IAAID,EAAW,CACjC,eAAgB,EAChB,sBAAuB,OACvB,GAAGD,EACH,MAAAR,EACA,GAAIK,EACA,CAAE,oBAAqB,GAAM,YAAa,EAAM,EAChD,CACN,CAAA,CAAC,EAEDM,EAAgBD,EAAmB,CAAE,SAAAJ,EAAU,WAAAC,CAAW,CAAC,EAE3DG,EAAkB,QAAQ,WAAahB,EACrCU,EACAM,CACF,EAGAA,EAAkB,MACpB,EAEA,MAAO,IAAY,CACjBA,GAAmB,MACrB,CAAA,EAEA,QAASE,EAAiB,QAAS,IAAM,CACvCF,GAAmB,OACrB,CAAC,CACH,CACF"}